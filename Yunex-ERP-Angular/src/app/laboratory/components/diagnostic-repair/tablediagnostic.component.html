<!-- Repair Table -->
<div>
  <div >
    <!-- Forms -->
    <div class="col d-flex justify-content-start">
      <div class="me-3"><app-init-repair-module></app-init-repair-module></div>
      <div><app-out-module></app-out-module></div>
    </div>
    <form class="col d-flex mb-5 justify-content-end" role="search">
      <input
        class="form-control me-2"
        type="search"
        placeholder="Buscar por ticket, fecha o módulo"
        aria-label="Buscar"
        name="filterTable"
        [(ngModel)]="filterTable"
        (ngModelChange)="applyFilter()"
      />
    </form>
    
    <!-- Table Controls -->
    <nav class="col" aria-label="Page navigation">
      <ul class="pagination justify-content-end bg-white">
        <!-- Botón para retroceder -->
        <li class="page-item me-2">
          <button
            class="btn btn-outline-primary"
            (click)="changePage(-1)"
            [disabled]="page === 0">
            &laquo;
          </button>
        </li>
    
        <!-- Número de página actual -->
        <li class="page-item disabled">
          <span class="btn text-secondary">Página {{ page + 1 }} de {{ totalPages }}</span>
        </li>
    
        <!-- Botón para avanzar -->
        <li class="page-item ms-2">
          <button
            class="btn btn-outline-primary"
            (click)="changePage(1)"
            [disabled]="page + 1 >= totalPages">
            &raquo;
          </button>
        </li>
      </ul>
    </nav>
    
  </div>
  <!-- View Table -->
  <div class="resTable table-container">
    <table class="table table-bordered border-primary">
      <thead>
        <tr class="table-success">
          <th scope="col" (click)="toggleOrderTicket()">
            <span *ngIf="order === 'asc' && orderType === 'Ticket'">↑</span>
            <span *ngIf="order !== 'asc' && orderType === 'Ticket'">↓</span>
            Ticket
          </th>
          <th scope="col" (click)="toggleOrderDate()">
            <span *ngIf="order === 'asc' && orderType === 'Date'">↑</span>
            <span *ngIf="order !== 'asc' && orderType === 'Date'">↓</span>
            Fecha de inicio
          </th>
          <th scope="col">Horas</th>
          <th scope="col">Equipo</th>
          <th scope="col">Ciudad</th>
          <th scope="col">Falla encontrada</th>
          <th scope="col">Estado modulo</th>
          <th scope="col">Reparación Estimada (Horas)</th>
          <th scope="col">Procedimiento</th>
          <th scope="col" (click)="toggleOrderTech()">
            <span *ngIf="order === 'asc' && orderType === 'Tech'">↑</span>
            <span *ngIf="order !== 'asc' && orderType === 'Tech'">↓</span>
            Responsable
          </th>
          <th scope="col">Módulo</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let labIncidence of visibleTickets | filter:filterTable"

          [ngClass]="{
            'table-warning': labIncidence.status === 'irreparable',
            'table-info': labIncidence.status === 'repaired',
            'table-secondary': labIncidence.status === 'approved'
          }"
        >
          <td (click)="toggleProcedure(labIncidence)" style="cursor: pointer;">{{ labIncidence.ticket }}</td>
          <td (click)="toggleProcedure(labIncidence)" style="cursor: pointer;">{{ labIncidence.admissionDate }}</td>
          <td (click)="toggleProcedure(labIncidence)" style="cursor: pointer;">{{ labIncidence.realRepairTime }}</td>
          <td (click)="toggleProcedure(labIncidence)" style="cursor: pointer;">{{ labIncidence.equipment }}</td>
          <td (click)="toggleProcedure(labIncidence)" style="cursor: pointer;">{{ labIncidence.city }}</td>
          <td (click)="toggleProcedure(labIncidence)" style="cursor: pointer;">{{ labIncidence.failure }}</td>
          <td (click)="toggleProcedure(labIncidence)" style="cursor: pointer;">{{ labIncidence.status }}</td>
          <td (click)="toggleProcedure(labIncidence)" style="cursor: pointer;">{{ labIncidence.estimatedRepairTime }}</td>
          <td (click)="toggleProcedure(labIncidence)" style="cursor: pointer;">
            {{ labIncidence.showFullProcedure ? labIncidence.repairProcedure : trimProcedure(labIncidence.repairProcedure) }}
          </td>
          <td (click)="toggleProcedure(labIncidence)" style="cursor: pointer;">{{ labIncidence.repairTechnician }}</td>
          <td (click)="toggleProcedure(labIncidence)" style="cursor: pointer;">{{ labIncidence.module.name }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
